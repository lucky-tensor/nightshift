#!/bin/bash
#
# Nightshift Commit-Msg Hook
# 
# Validates commit message format.
# Requires commit messages to be at least 10 characters.
#
# Installation:
#   cp .nightshift/hooks/commit-msg .git/hooks/commit-msg
#   chmod +x .git/hooks/commit-msg
#

COMMIT_MSG_FILE="$1"

# Bypass check
[ -n "$NIGHTSHIFT_BYPASS" ] && exit 0

# Read and strip comments
MSG=$(grep -v "^#" "$COMMIT_MSG_FILE" | tr -d '\n' | xargs)

# Check length
if [ ${#MSG} -lt 10 ]; then
    echo ""
    echo "╔════════════════════════════════════════════════════════════╗"
    echo "║           ❌ COMMIT BLOCKED - MESSAGE TOO SHORT            ║"
    echo "╠════════════════════════════════════════════════════════════╣"
    echo "║  Commit messages must be descriptive (10+ chars).          ║"
    echo "║                                                            ║"
    echo "║  Good examples:                                            ║"
    echo "║    feat: add user login endpoint                           ║"
    echo "║    fix: resolve null pointer in auth                       ║"
    echo "║    refactor: extract validation logic                      ║"
    echo "╚════════════════════════════════════════════════════════════╝"
    echo ""
    exit 1
fi

exit 0
