#!/usr/bin/env node
/**
 * Nightshift Commit-Msg Hook
 * 
 * Validates commit message format.
 * 
 * Installation:
 *   cp templates/hooks/commit-msg .git/hooks/commit-msg
 *   chmod +x .git/hooks/commit-msg
 */

const fs = require('fs');

function main() {
    const commitMsgFile = process.argv[2];

    // Bypass check
    if (process.env.NIGHTSHIFT_BYPASS) {
        return 0;
    }

    if (!commitMsgFile) {
        return 0;
    }

    // Read commit message
    let msg;
    try {
        msg = fs.readFileSync(commitMsgFile, 'utf-8');
    } catch {
        return 0;
    }

    // Strip comments and check length
    const stripped = msg
        .split('\n')
        .filter(line => !line.startsWith('#'))
        .join('')
        .trim();

    if (stripped.length < 10) {
        const box = (text, pad = 56) => '║  ' + text.padEnd(pad) + '  ║';
        
        console.error('');
        console.error('╔════════════════════════════════════════════════════════════╗');
        console.error('║           ❌ COMMIT BLOCKED - MESSAGE TOO SHORT            ║');
        console.error('╠════════════════════════════════════════════════════════════╣');
        console.error(box('Commit messages must be descriptive.'));
        console.error(box(''));
        console.error(box('Good examples:'));
        console.error(box('  feat: add user login endpoint'));
        console.error(box('  fix: resolve null pointer in auth'));
        console.error(box('  refactor: extract validation logic'));
        console.error('╚════════════════════════════════════════════════════════════╝');
        console.error('');
        return 1;
    }

    return 0;
}

process.exit(main());
